# Frontend 開発規約

本ドキュメントは、プロジェクトのフロントエンド開発における品質、保守性、パフォーマンスを担保するための規約を定義します。

## 1. 📜 基本原則

> **「UI は、予測可能で、高速で、型安全であること」**

- **宣言的 UI:** すべての UI は現在の状態（State）のみから導出されるように記述します。`document.getElementById` のような命令的な DOM 操作を原則禁止します。
- **関心の分離:** 「データ取得ロジック」「グローバルな UI 状態」「コンポーネントローカルな状態」を明確に分離します。
- **パフォーマンス意識:** 常に Core Web Vitals (LCP, INP) を意識し、不必要な再レンダリングやバンドルサイズの増大を防ぎます。

## 2. TypeScript & コーディングスタイル

- **型安全:**
  - TypeScript の `strict: true` を必須とします。
  - `any` 型の使用を原則禁止します。不明な型は `unknown` を使用し、型ガードで絞り込みます。
  - API レスポンスなど、外部から取得するデータには `Zod` などのバリデーションライブラリを用いて型を保証します。
- **コードフォーマット:**
  - **Prettier** を必須とします。エディタでの保存時に自動フォーマットされるよう設定してください。
  - **ESLint** を必須とします。`eslint-plugin-react-hooks` の `exhaustive-deps` (依存配列の網羅性) ルール違反を修正せずにマージすることを禁止します。
- **命名規則:**
  - コンポーネント: `PascalCase` (例: `VideoPlayer.tsx`)
  - 変数・関数: `camelCase` (例: `playVideo`)
  - カスタムフック: `use` プレフィックス (例: `useVideoFeed`)

## 3. 🧩 コンポーネント設計

- **コンポーネントの責務:**
  - コンポーネントは「単一責任の原則」に従います。
  - データ取得や複雑なビジネスロジックは、カスタムフック (`use...`) やサービスクラスに分離し、コンポーネントは主に UI のレンダリングとイベントハンドリングに集中します。
- **ディレクトリ構成:**
  - 機能単位での Colocation (コロケーション) を推奨します。
  - 例: `/features/video/components/VideoPlayer.tsx`, `/features/video/hooks/useVideoFeed.ts`
- **パフォーマンス:**
  - **`React.memo`:** 再レンダリングコストが高い（例: 巨大なリスト、複雑な SVG）コンポーネントにのみ使用します。むやみに使用しないでください。
  - **`useMemo` / `useCallback`:** 関数やオブジェクトを依存配列（`useEffect`, `React.memo`）に渡す場合にのみ使用します。

## 4. 🌀 データ取得 (Server State)

- **SWR (推奨) or React Query:**
  - API からのデータ取得は、**SWR** または **React Query** の使用を原則とします。
  - `useEffect` と `useState` を使った手動でのデータ取得は、特別な理由がない限り禁止します（キャッシュ、再検証、エラーハンドリングが複雑化するため）。
- **API モジュール:**
  - API リクエストのロジック (`fetch` や `axios`) は、 `/lib/apiClient.ts` のような中央集権的なモジュールに集約します。コンポーネントが直接 `fetch` を叩かないでください。
- **R2 へのファイルアップロードに関する注意:**
  - `/api/upload/sign` から取得した署名付き URL を使用して R2 へ直接ファイルをアップロードする際、**CORS エラー** が発生する場合があります。
  - これは Cloudflare R2 バケット側の設定が原因です。エラーが発生した場合、`docs/backend.md` の「R2 アップロード時の CORS エラー対応」セクションを参照し、バックエンド担当者と設定を確認してください。

## 5. 💅 スタイリング (Tailwind CSS)

- **ユーティリティファースト:** 可能な限り Tailwind のユーティリティクラス（`m-2`, `flex` など）を使用します。
- **共通コンポーネント:** 3 回以上同じスタイルの組み合わせが登場した場合、共通コンポーネント（例: `<Button>`, `<Card>`）として切り出します。
- **`@apply` の禁止:** CSS ファイル内での `@apply` の使用は、コードの可読性と保守性を著しく下げるため、原則禁止します。
- **設定ファイル:**
  - ブランドカラー、フォントサイズ、特定のスペーシング（`15px` など）は、`tailwind.config.js` の `theme.extend` で定義し、ハードコードを避けます。
- **条件分岐:**
  - `clsx` や `tailwind-merge` ライブラリを使用し、クラス名の条件分岐をクリーンに保ちます。

## 6. ✅ テスト

- **ユニットテスト (Vitest / Jest):**
  - 対象: カスタムフック、ユーティリティ関数、複雑なビジネスロジック。
  - React Testing Library を使用し、コンポーネントの内部実装ではなく「ユーザーからどう見えるか」をテストします。
- **E2E テスト (Playwright / Cypress):**
  - 対象: クリティカルパス（例: ログインフロー、動画アップロードフロー、いいね・保存フロー）。
